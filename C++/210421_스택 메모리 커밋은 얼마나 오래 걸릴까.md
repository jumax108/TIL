# 스택 메모리 커밋은 얼마나 오래 걸릴까

가상 메모리를 공부하다가 궁금해진 점이다.

스택은 예약만 우선 걸어두고 사용하면서 커밋한다.

그럼 이 작업은 얼마나 시스템 성능을 떨어뜨릴까 ?
반대로 사전에 커밋을 완료하면 얼마나 성능이 올라갈까 ?

아래 예제로 실험해보았다.

___ ___

```c++
for (int i = 0; i < 250000000; i++) {
    __asm {
        push ebp
    }
}
```

단순하게 push ebp를 2억 5천만번 진행한다.
정말 열심히 스택을 낭비하는 코드이다.

이것을 스택 예약만 1GB로 잡은 상황과 스택 예약/커밋을 1GB로 잡은 상황에서 돌려보았다.

___ ____

## 스택 예약만 1GB로 설정한 상황

평균적으로 866ms가 측정되었다.

작업 관리자에서 봤을때도 커밋 크기가 실시간으로 늘어나는 것을 확인할 수 있었다.

그렇다면 커밋을 한 상태에서는 어떨까

--- ---

## 스택 커밋도 1GB로 설정한 상황

평균 545ms가 측정되었다.

작업 관리자에서 봤을때도 커밋 크기가 처음부터 1GB 정도되었다.

___ ___

## 결과

역시 커밋을 하는 것만으로도 내부적으로 많은 리소스가 소모되고 있었음을 알 수 있었다.

힙 또한 스택보다 더 느리면 느렸지 빠르지는 않을 것으로 예상된다.

